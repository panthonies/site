<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Anthony Pan | Programming in R: Iteration</title>
  <meta name="description" content="In which we explore the basics of iteration through the lenses of functional and imperative programming by examining for loops, map functions, and more.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Programming in R: Iteration">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://localhost:4000/posts/programming-r-2">
  <meta property="og:description" content="In which we explore the basics of iteration through the lenses of functional and imperative programming by examining for loops, map functions, and more.">
  <meta property="og:site_name" content="Anthony Pan">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="http://localhost:4000/posts/programming-r-2">
  <meta name="twitter:title" content="Programming in R: Iteration">
  <meta name="twitter:description" content="In which we explore the basics of iteration through the lenses of functional and imperative programming by examining for loops, map functions, and more.">

  
    <meta property="og:image" content="http://localhost:4000/assets/anthony-pan-8360313f1fe7e4685c1a12403f392eb92d3b49dbd4ccfa196dbebf0ddb4ba974.jpg">
    <meta name="twitter:image" content="http://localhost:4000/assets/anthony-pan-8360313f1fe7e4685c1a12403f392eb92d3b49dbd4ccfa196dbebf0ddb4ba974.jpg">
  

  <link href="http://localhost:4000/feed.xml" type="application/rss+xml" rel="alternate" title="Anthony Pan Last 10 blog posts" />

  

  

    
      <link rel="icon" type="image/x-icon" href="/assets/favicon-light-a98c41efc5ed9fcc06ac664c9e2f7a9b3c3b2e0a52357d221fe382f6f4abc8fc.ico">
      <link rel="apple-touch-icon" href="/assets/apple-touch-icon-light-87d1f2a3a19b1500e5c1626a0492025ca5f7f97d24540dc5900288e92112925a.png">
      <link rel="stylesheet" type="text/css" href="/assets/light-3ebe45100a3d97f8ac94857224f3fde7193d453226ebbb900022771bfa032719.css">
    

  

</head>
<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav ">
  <a href="/" class="header-logo" title="Anthony Pan">Anthony Pan</a>
  <ul class="header-links">
    
      <li>
        <a href="/" title="About me">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-about">
  <use href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about" xlink:href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="/posts/index" title="Blog">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-writing">
  <use href="/assets/writing-b6140719fc6ec0b803300a902e95d85fe15bbc322fb150e13e61ff0be4439d3b.svg#icon-writing" xlink:href="/assets/writing-b6140719fc6ec0b803300a902e95d85fe15bbc322fb150e13e61ff0be4439d3b.svg#icon-writing"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
  </ul>
</nav>



        <article class="article ">
          <header class="article-header">
            <h1>Programming in R: Iteration</h1>
            <p>In which we explore the basics of iteration through the lenses of functional and imperative programming by examining for loops, map functions, and more.</p>
            <div class="article-list-footer">
  <span class="article-list-date">
    February 25, 2020
  </span>
  <span class="article-list-divider">-</span>
  <span class="article-list-minutes">
    
    
      12 minute read
    
  </span>
  <span class="article-list-divider">-</span>
  <div class="article-list-tags">
    
      
      <a href="/tag/academic" title="See all posts with tag 'academic'">academic</a>
    
      
      <a href="/tag/r" title="See all posts with tag 'r'">r</a>
    
  </div>
</div>
          </header>

          <div class="article-content">
            <p>Iteration, like functions, serve to reduce the amount of duplication in code. In R, this comes in two flavors: imperative programming, such as for and while loops, and functional programming, which avoids changing-state data.<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup></p>

<h2 id="imperative-programming-for-loops">Imperative Programming: For Loops</h2>
<p>When creating for loops in R, it’s important to allocate sufficient space for new objects using the <code class="highlighter-rouge">vector()</code> function. For example, we create a new object that computes the median of each column of a data frame:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">output</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="s2">"double"</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="p">(</span><span class="n">df</span><span class="p">))</span><span class="w"> </span><span class="c1"># 1. output: make sure to allocate sufficient space</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">df</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">          </span><span class="c1"># 2. sequence: how should the function iterate?</span><span class="w">
  </span><span class="n">output</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">median</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="n">i</span><span class="p">]])</span><span class="w">   </span><span class="c1"># 3. body: what should the code do for each case?</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>There are a couple of looping patterns worth noting:</p>
<ol>
  <li><code class="highlighter-rouge">for (i in seq_along(xs))</code> loops over indices; this is the most common way to construct for loops.</li>
  <li><code class="highlighter-rouge">for (x in xs)</code> loops over elements; this is useful if you only care about side effects like plots.</li>
  <li><code class="highlighter-rouge">for (nm in names(xs))</code> loops over names; this is useful if you only need names</li>
</ol>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># using seq_along(), we can extract names and values of all indices</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">x</span><span class="p">)[[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="c1"># extract names</span><span class="w">
  </span><span class="n">value</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="c1"># extract values</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>Most of the time, you will know what form the function output will take. However, if the length of the output is unknown, combine the data into a single object after the loop is complete:</p>
<ul>
  <li>When generating an unknown number of results, save vectors to a list and combine them into a single vector with <code class="highlighter-rouge">unlist()</code></li>
  <li>When generating a long string, save outputs in a character vector and combine them into a single string with <code class="highlighter-rouge">paste(output, collapse = "")</code></li>
  <li>When generating a big data frame, save output to a list and combine them into a single data frame with <code class="highlighter-rouge">bind_rows(output)</code></li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># sample a random number (1-100) of observations from a normal dist with different means</span><span class="w">
</span><span class="n">means</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="s2">"list"</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">means</span><span class="p">))</span><span class="w"> </span><span class="c1"># create a list of length 3</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">means</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
  </span><span class="n">out</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">means</span><span class="p">[[</span><span class="n">i</span><span class="p">]])</span><span class="w"> </span><span class="c1"># store data in list values</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">unlist</span><span class="p">(</span><span class="n">out</span><span class="p">))</span><span class="w"> </span><span class="c1"># flatten list of vectors into a single vector</span></code></pre></figure>

<p>As an example exercise to demonstrate the syntax of for loops, let’s write a function that takes a data frame, and prints the mean of each numeric column next to the name of that column.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">show_means</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">numeric_cols</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select_if</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">is.numeric</span><span class="p">)</span><span class="w"> </span><span class="c1"># filter on numeric columns</span><span class="w">
  </span><span class="n">numeric_means</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="s2">"list"</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">numeric_cols</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1"># populate the list with names and means</span><span class="w">
    </span><span class="n">numeric_means</span><span class="p">[[</span><span class="m">1</span><span class="p">]][[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">numeric_cols</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w">
    </span><span class="n">numeric_means</span><span class="p">[[</span><span class="m">2</span><span class="p">]][[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_cols</span><span class="p">[[</span><span class="n">i</span><span class="p">]]),</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">str_count</span><span class="p">(</span><span class="n">numeric_means</span><span class="p">[[</span><span class="m">1</span><span class="p">]])</span><span class="w">
  </span><span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">str_count</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="n">numeric_means</span><span class="p">[[</span><span class="m">2</span><span class="p">]],</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w">
  </span><span class="n">padding</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">numeric_means</span><span class="p">[[</span><span class="m">1</span><span class="p">]]))</span><span class="w"> </span><span class="c1"># print names and means with padding</span><span class="w">
    </span><span class="n">cat</span><span class="p">(</span><span class="n">numeric_means</span><span class="p">[[</span><span class="m">1</span><span class="p">]][[</span><span class="n">i</span><span class="p">]],</span><span class="w"> </span><span class="s2">": "</span><span class="p">,</span><span class="w"> </span><span class="n">str_dup</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span><span class="w"> </span><span class="n">padding</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="w"> 
      </span><span class="n">format</span><span class="p">(</span><span class="n">numeric_means</span><span class="p">[[</span><span class="m">2</span><span class="p">]][[</span><span class="n">i</span><span class="p">]],</span><span class="w"> </span><span class="n">nsmall</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">show_means</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Sepal.Length: 5.84</span><span class="w">
</span><span class="c1">#&gt; Sepal.Width:  3.06</span><span class="w">
</span><span class="c1">#&gt; Petal.Length: 3.76</span><span class="w">
</span><span class="c1">#&gt; Petal.Width:  1.20</span></code></pre></figure>

<h2 id="functional-programming-map-functions">Functional Programming: Map Functions</h2>
<p>Map functions automate the pattern of looping over a vector, applying a function to each piece, and returning a new vector that’s the same length as the input. These functions are a part of the <em>purrr</em> package, which are implemented in C for speed. There is one map function for each type of output:</p>

<ul>
  <li><code class="highlighter-rouge">map()</code> makes a list</li>
  <li><code class="highlighter-rouge">map_lgl()</code> makes a logical vector</li>
  <li><code class="highlighter-rouge">map_int()</code> makes an integer vector</li>
  <li><code class="highlighter-rouge">map_dbl()</code> makes a double vector</li>
  <li><code class="highlighter-rouge">map_chr()</code> makes a character vector</li>
</ul>

<p><strong>Example 1:</strong> The most basic case – calculate the means of all columns of the <em>mtcars</em> dataset.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="s2">"purrr"</span><span class="p">)</span><span class="w">
</span><span class="n">map_dbl</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span></code></pre></figure>

<p><strong>Example 2:</strong> Pass in a one-sided formula for anonymous functions. For each value of the number of cylinders on a car, what is the the linear relationship between miles per gallon and car weight?</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">models</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mtcars</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">split</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">cyl</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map</span><span class="p">(</span><span class="o">~</span><span class="n">lm</span><span class="p">(</span><span class="n">mpg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">wt</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="p">))</span></code></pre></figure>

<p><strong>Example 3:</strong> Extract named components from a function using a string. For each linear relationship between miles per gallon and car weight by the number of cylinders, what is the correlation?</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">models</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map_dbl</span><span class="p">(</span><span class="s2">"r.squared"</span><span class="p">)</span></code></pre></figure>

<p><strong>Example 4:</strong> Select elements by position by passing in an integer. Select the elements in the second position of a list.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">))</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">map_dbl</span><span class="p">(</span><span class="m">2</span><span class="p">)</span></code></pre></figure>

<h4 id="dealing-with-mapping-failures-safely-possibly-and-quietly">Dealing with mapping failures: <strong>safely()</strong>, <strong>possibly()</strong>, and <strong>quietly()</strong></h4>
<p>If any one of the mapping operations fails, then an error message will be returned with no output. There are three ways to deal with failures:</p>

<ol>
  <li><code class="highlighter-rouge">safely()</code> returns a modified version of a function that returns a list of two elements – result and error.</li>
</ol>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="s2">"a"</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">map</span><span class="p">(</span><span class="n">safely</span><span class="p">(</span><span class="n">log</span><span class="p">))</span><span class="w">
  </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">str</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt; List of 3</span><span class="w">
</span><span class="c1">#&gt;  $ :List of 2</span><span class="w">
</span><span class="c1">#&gt;   ..$ result: num 0</span><span class="w">
</span><span class="c1">#&gt;   ..$ error : NULL</span><span class="w">
</span><span class="c1">#&gt;  $ :List of 2</span><span class="w">
</span><span class="c1">#&gt;   ..$ result: num 2.3</span><span class="w">
</span><span class="c1">#&gt;   ..$ error : NULL</span><span class="w">
</span><span class="c1">#&gt;  $ :List of 2</span><span class="w">
</span><span class="c1">#&gt;   ..$ result: NULL</span><span class="w">
</span><span class="c1">#&gt;   ..$ error :List of 2</span><span class="w">
</span><span class="c1">#&gt;   .. ..$ message: chr "non-numeric argument to mathematical function"</span><span class="w">
</span><span class="c1">#&gt;   .. ..$ call   : language .Primitive("log")(x, base)</span><span class="w">
</span><span class="c1">#&gt;   .. ..- attr(*, "class")= chr [1:3] "simpleError" "error" "condition"</span></code></pre></figure>

<ol start="2">
  <li><code class="highlighter-rouge">possibly()</code> always always succeeds, but gives a default value when there is an error.</li>
</ol>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="s2">"a"</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">map_dbl</span><span class="p">(</span><span class="n">possibly</span><span class="p">(</span><span class="n">log</span><span class="p">,</span><span class="w"> </span><span class="kc">NA_real_</span><span class="p">))</span><span class="w">
  </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">str</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt; num [1:3] 0 2.3 NA</span></code></pre></figure>

<ol start="3">
  <li><code class="highlighter-rouge">quietly()</code> captures printed output, messages, and warnings instead of errors.</li>
</ol>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">-1</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">map</span><span class="p">(</span><span class="n">quietly</span><span class="p">(</span><span class="n">log</span><span class="p">))</span><span class="w"> 
  </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">str</span><span class="p">()</span><span class="w"> 
</span><span class="c1">#&gt; List of 2</span><span class="w">
</span><span class="c1">#&gt;  $ :List of 4</span><span class="w">
</span><span class="c1">#&gt;   ..$ result  : num 0</span><span class="w">
</span><span class="c1">#&gt;   ..$ output  : chr ""</span><span class="w">
</span><span class="c1">#&gt;   ..$ warnings: chr(0) </span><span class="w">
</span><span class="c1">#&gt;   ..$ messages: chr(0) </span><span class="w">
</span><span class="c1">#&gt;  $ :List of 4</span><span class="w">
</span><span class="c1">#&gt;   ..$ result  : num NaN</span><span class="w">
</span><span class="c1">#&gt;   ..$ output  : chr ""</span><span class="w">
</span><span class="c1">#&gt;   ..$ warnings: chr "NaNs produced"</span><span class="w">
</span><span class="c1">#&gt;   ..$ messages: chr(0) </span></code></pre></figure>

<h4 id="map-a-function-over-multiple-arguments-map2-and-pmap">Map a function over multiple arguments: <strong>map2()</strong> and <strong>pmap()</strong></h4>
<ol>
  <li><code class="highlighter-rouge">map2()</code> allows you to iterate along two related inputs in parallel. As an example, we can draw a random sample from the normal distribution with three different mean and standard deviation pairs:</li>
</ol>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">mu</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w">
</span><span class="n">sigma</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="n">map2</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="n">rnorm</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">str</span><span class="p">()</span></code></pre></figure>

<ol start="2">
  <li><code class="highlighter-rouge">pmap()</code>, on a similar note, iterates along a list of related inputs in parallel. If your arguments are the same length, it is best practice to store them in a data frame. For example, we can vary the mean, standard deviation, and the number of samples from a normal distribution:</li>
</ol>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">params</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tribble</span><span class="p">(</span><span class="w">
  </span><span class="o">~</span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">sd</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">n</span><span class="p">,</span><span class="w">
    </span><span class="m">5</span><span class="p">,</span><span class="w">     </span><span class="m">1</span><span class="p">,</span><span class="w">  </span><span class="m">1</span><span class="p">,</span><span class="w">
   </span><span class="m">10</span><span class="p">,</span><span class="w">     </span><span class="m">5</span><span class="p">,</span><span class="w">  </span><span class="m">3</span><span class="p">,</span><span class="w">
   </span><span class="m">-3</span><span class="p">,</span><span class="w">    </span><span class="m">10</span><span class="p">,</span><span class="w">  </span><span class="m">5</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="n">params</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">pmap</span><span class="p">(</span><span class="n">rnorm</span><span class="p">)</span></code></pre></figure>

<h4 id="map-multiple-functions-with-multiple-sets-of-arguments-invoke_map">Map multiple functions with multiple sets of arguments: <strong>invoke_map()</strong></h4>

<p><code class="highlighter-rouge">invoke_map()</code> can invoke different functions with multiple parameters. Use a data frame to make matching pairs easier. For example, we can generate samples from three different types of distributions with their own inputs:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">sim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tribble</span><span class="p">(</span><span class="w"> </span><span class="c1"># use a data frame to make matching pairs easier</span><span class="w">
  </span><span class="o">~</span><span class="n">f</span><span class="p">,</span><span class="w">      </span><span class="o">~</span><span class="n">params</span><span class="p">,</span><span class="w">
  </span><span class="s2">"runif"</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w">
  </span><span class="s2">"rnorm"</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">),</span><span class="w">
  </span><span class="s2">"rpois"</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="n">sim</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">sim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">invoke_map</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">))</span></code></pre></figure>

<h4 id="walk-an-alternative-to-map">Walk: an alternative to map</h4>

<p>When you want to call a function for its side effects, such as printing output to the screen or saving files to disk, you can use the walk functions: <code class="highlighter-rouge">walk(), walk2(), pwalk()</code>.</p>

<p>For example, if you had a list of plots and a vector of file names, you can use the <code class="highlighter-rouge">pwalk()</code> function to save each file to teh corresponding location on disk.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">plots</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mtcars</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">split</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">cyl</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map</span><span class="p">(</span><span class="o">~</span><span class="n">ggplot</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">wt</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">())</span><span class="w">
</span><span class="n">paths</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stringr</span><span class="o">::</span><span class="n">str_c</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">plots</span><span class="p">),</span><span class="w"> </span><span class="s2">".pdf"</span><span class="p">)</span><span class="w">

</span><span class="n">pwalk</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span><span class="w"> </span><span class="n">plots</span><span class="p">),</span><span class="w"> </span><span class="n">ggsave</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tempdir</span><span class="p">())</span></code></pre></figure>

<p>Note: these functions all invisibly return the first argument, which makes them suitable for use in the middle of pipelines.</p>

<h2 id="functional-programming-other-patterns">Functional Programming: Other Patterns</h2>

<p>There are a number of other functions in the <em>purrr</em> package that abstract over other types of for loops, including predicate functions, reduce, and accumulate.</p>

<h4 id="predicate-functions-check-a-condition-returning-either-true-or-false">Predicate functions check a condition, returning either TRUE or FALSE</h4>

<ul>
  <li><code class="highlighter-rouge">keep()</code> keeps element where the predicate is true</li>
  <li><code class="highlighter-rouge">discard()</code> discards elements where the predicate is false</li>
  <li><code class="highlighter-rouge">some()</code> and <code class="highlighter-rouge">every()</code> determines if the predicate is true for any or all of the elements</li>
  <li><code class="highlighter-rouge">detect()</code> finds the first element where true, detect_index returns its position</li>
  <li><code class="highlighter-rouge">head_while()</code> and <code class="highlighter-rouge">tail_while()</code> take elements from the start r end of a vector while a predicate is true</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># keep columns that are factors</span><span class="w">
</span><span class="n">iris</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">keep</span><span class="p">(</span><span class="n">is.factor</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">str</span><span class="p">()</span><span class="w">

</span><span class="c1"># discard columns that are factors</span><span class="w">
</span><span class="n">iris</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">discard</span><span class="p">(</span><span class="n">is.factor</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">str</span><span class="p">()</span><span class="w">

</span><span class="c1"># check if some or all elements are characters</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="nb">letters</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">10</span><span class="p">))</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">some</span><span class="p">(</span><span class="n">is_character</span><span class="p">)</span><span class="w"> </span><span class="c1"># are any elements characters?</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">every</span><span class="p">(</span><span class="n">is_vector</span><span class="p">)</span><span class="w"> </span><span class="c1"># are all elements vectors?</span><span class="w">

</span><span class="c1"># detect the first element, and the index of the first element, that is &gt; 5</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">detect</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">detect_index</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">

</span><span class="c1"># show elements from the head or tail of the list until a value of &gt; 5</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">head_while</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">tail_while</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">5</span><span class="p">)</span></code></pre></figure>

<h4 id="reduce-and-accumulate-use-a-binary-function-to-simplify-complex-lists">Reduce and Accumulate use a binary function to simplify complex lists</h4>

<p><code class="highlighter-rouge">reduce()</code> takes a binary function – a function with two primary inputs – and applies it to a list until only one element is left.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># find the intersection of all vectors in a list</span><span class="w">
</span><span class="n">vs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
  </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">),</span><span class="w">
  </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">),</span><span class="w">
  </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="n">vs</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">reduce</span><span class="p">(</span><span class="n">intersect</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1]  1  3 10</span></code></pre></figure>

<p><code class="highlighter-rouge">accumulate()</code> is the same as reduce except it keeps all of the interim results.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># accumulate the values of a random sampling from 1-10</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">accumulate</span><span class="p">(</span><span class="n">`+`</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1]  8 18 27 34 36 37 43 46 50 55</span></code></pre></figure>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>This post is meant for a person who is looking for a refresher on basic programming in R, and the content in this post is based on chapter twenty-one of <a href="https://r4ds.had.co.nz/index.html" target="blank">R for Data Science</a> by Hadley Wickham &amp; Garrett Grolemund. <a href="#fnref:1" class="reversefootnote">⤴</a></p>
    </li>
  </ol>
</div>

          </div>
          <!--
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=Programming+in+R:+Iteration%20-%20http://localhost:4000/posts/programming-r-2" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/posts/programming-r-2" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
          </div>
          -->
          <span class="backbutton"><a href="/posts/index">←Index</a></span>
          
        </article>
        <footer class="footer ">

<small class="pull-left"> &copy;2020 All rights reserved. 

<a href="https://github.com/nielsenramon/chalk" target="_blank">Chalk</a> theme by Nielson Ramon.

</small>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-160038909-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-160038909-1');
  </script>


<script src="/assets/vendor-2c224c53eb697c739f9490c38819a72184f09472739fd9e492272ef174090428.js" type="text/javascript"></script>


  <script src="/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js" type="text/javascript"></script>




<script src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js" type="text/javascript"></script>


  <script type="text/x-mathjax-config">
   MathJax.Hub.Config({
     extensions: [
       "MathMenu.js",
       "MathZoom.js",
       "AssistiveMML.js",
       "a11y/accessibility-menu.js"
     ],
     jax: ["input/TeX", "output/CommonHTML"],
     TeX: {
       extensions: [
         "AMSmath.js",
         "AMSsymbols.js",
         "noErrors.js",
         "noUndefined.js",
       ]
     }
   });
   MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
     var TEX = MathJax.InputJax.TeX;
     var COLS = function (W) {
       var WW = [];
       for (var i = 0, m = W.length; i < m; i++)
         {WW[i] = TEX.Parse.prototype.Em(W[i])}
       return WW.join(" ");
     };
     TEX.Definitions.Add({
       environment: {
         psmallmatrix: ['Array',null,'(',')','c',COLS([1/3]),".2em",'S',1],
       }
     });
   });
 </script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
</html>
