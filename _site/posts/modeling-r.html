<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Anthony Pan | Index: Start Here</title>
  <meta name="description" content="An introduction to this blog, and a list of all my posts.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Index: Start Here">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://localhost:4000/posts/index">
  <meta property="og:description" content="An introduction to this blog, and a list of all my posts.">
  <meta property="og:site_name" content="Anthony Pan">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="http://localhost:4000/posts/index">
  <meta name="twitter:title" content="Index: Start Here">
  <meta name="twitter:description" content="An introduction to this blog, and a list of all my posts.">

  
    <meta property="og:image" content="http://localhost:4000/assets/og-image-ee46bbc61b334e821e81534b1fd43f3fee6f020ec174b3c2114445695fd48c01.jpg">
    <meta name="twitter:image" content="http://localhost:4000/assets/og-image-ee46bbc61b334e821e81534b1fd43f3fee6f020ec174b3c2114445695fd48c01.jpg">
  

  <link href="http://localhost:4000/feed.xml" type="application/rss+xml" rel="alternate" title="Anthony Pan Last 10 blog posts" />

  

  

    
      <link rel="icon" type="image/x-icon" href="/assets/favicon-light-a98c41efc5ed9fcc06ac664c9e2f7a9b3c3b2e0a52357d221fe382f6f4abc8fc.ico">
      <link rel="apple-touch-icon" href="/assets/apple-touch-icon-light-87d1f2a3a19b1500e5c1626a0492025ca5f7f97d24540dc5900288e92112925a.png">
      <link rel="stylesheet" type="text/css" href="/assets/light-a9fc964bae0eff58d5753446101afffa3ba3340308dfaeac900b709cb454a94f.css">
    

  

</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav ">
  <a href="/" class="header-logo" title="Anthony Pan">Anthony Pan</a>
  <ul class="header-links">
    
      <li>
        <a href="/" title="About me">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-about">
  <use href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about" xlink:href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="/posts/index" title="Blog">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-writing">
  <use href="/assets/writing-b6140719fc6ec0b803300a902e95d85fe15bbc322fb150e13e61ff0be4439d3b.svg#icon-writing" xlink:href="/assets/writing-b6140719fc6ec0b803300a902e95d85fe15bbc322fb150e13e61ff0be4439d3b.svg#icon-writing"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
  </ul>
</nav>



        <article class="article ">
          <header class="article-header">
            <h1>Model Building in R</h1>
            <p>In which we explore the basics of modeling as an exploratory tool through recording and graphing predictions and residuals, variable interactions, and transformations.</p>
            <div class="article-list-footer">
  <span class="article-list-date">
    February 28, 2020
  </span>
  <span class="article-list-divider">-</span>
  <span class="article-list-minutes">
    
    
      11 minute read
    
  </span>
  <span class="article-list-divider">-</span>
  <div class="article-list-tags">
    
      
      <a href="/tag/academic" title="See all posts with tag 'academic'">academic</a>
    
      
      <a href="/tag/r" title="See all posts with tag 'r'">r</a>
    
  </div>
</div>
          </header>

          <div class="article-content">
            <p>This post provides an introduction to modeling in R without going into statistical details.<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup> We’ll go over some examples of fitting models to data, and then examine the list-column data structure. The following libraries are used:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="s2">"tidyverse"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"modelr"</span><span class="p">)</span><span class="w">              </span><span class="c1"># tools for modeling</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"splines"</span><span class="p">)</span><span class="w">             </span><span class="c1"># tools for modeling with polynomials</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"broom"</span><span class="p">)</span><span class="w">               </span><span class="c1"># tools for turning models into tidy data frames</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"gapminder"</span><span class="p">)</span><span class="w">           </span><span class="c1"># dataset with country descriptive data over time</span><span class="w">
</span><span class="n">options</span><span class="p">(</span><span class="n">na.action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">na.warn</span><span class="p">)</span><span class="w"> </span><span class="c1"># warns you if models drop data</span></code></pre></figure>

<h2 id="model-basics">Model Basics</h2>

<p>Let’s go through an example exploratory workflow of fitting a model to a continuous variable using simulated dataset <code class="highlighter-rouge">sim1</code>:</p>

<h5 id="1-graph-the-initial-data">1. <strong>Graph the initial data.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ggplot</span><span class="p">(</span><span class="n">sim1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span></code></pre></figure>

<p><a href="/assets/02-28-cont-graph-6ed43a5473ed159b63c2587b13e4cc4bc54529ec001060bde9689585dd50fc24.png">
  <img src="/assets/02-28-cont-graph-6ed43a5473ed159b63c2587b13e4cc4bc54529ec001060bde9689585dd50fc24.png" alt="Graph Continuous Variable" class="zooming" data-rjs="/assets/02-28-cont-graph-6ed43a5473ed159b63c2587b13e4cc4bc54529ec001060bde9689585dd50fc24.png" data-zooming-width="" data-zooming-height="" />
</a></p>

<h5 start="2" id="2-fit-a-simple-linear-regression-to-the-data">2. <strong>Fit a simple linear regression to the data.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">sim1_mod</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim1</span><span class="p">)</span></code></pre></figure>

<p><strong>Note:</strong> To model an interaction between x-variables, use <code class="highlighter-rouge">*</code></p>

<h5 start="3" id="3-create-a-new-data-frame-with-model-prediction-data">3. <strong>Create a new data frame with model prediction data.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sim1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">data_grid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">add_predictions</span><span class="p">(</span><span class="n">sim1_mod</span><span class="p">)</span><span class="w"> </span></code></pre></figure>

<p><strong>Note:</strong> <code class="highlighter-rouge">add_predictions()</code> adds a single new column with model predictions, <code class="highlighter-rouge">spread_predictions()</code> adds one column for each model, and <code class="highlighter-rouge">gather_predictions()</code> two columns, model and prediction, and repeats the input rows for each model.</p>

<h5 start="4" id="4-graph-the-initial-data-with-the-fitted-model">4. <strong>Graph the initial data with the fitted model.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ggplot</span><span class="p">(</span><span class="n">sim1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pred</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span></code></pre></figure>

<p><a href="/assets/02-28-cont-graph-2-4a627b6e04562225dd0630135ded9f714babb1e4ff08715fc1522f0c4962ad2e.png">
  <img src="/assets/02-28-cont-graph-2-4a627b6e04562225dd0630135ded9f714babb1e4ff08715fc1522f0c4962ad2e.png" alt="Graph Continuous Variable with Predictions" class="zooming" data-rjs="/assets/02-28-cont-graph-2-4a627b6e04562225dd0630135ded9f714babb1e4ff08715fc1522f0c4962ad2e.png" data-zooming-width="" data-zooming-height="" />
</a></p>

<h5 start="5" id="5-add-the-residuals-to-the-initial-data">5. <strong>Add the residuals to the initial data.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">sim1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sim1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">add_residuals</span><span class="p">(</span><span class="n">sim1_mod</span><span class="p">)</span></code></pre></figure>

<h5 start="6" id="6-graph-the-initial-x-values-against-their-residuals">6. <strong>Graph the initial x-values against their residuals.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ggplot</span><span class="p">(</span><span class="n">sim1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">resid</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_ref_line</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_point</span><span class="p">()</span></code></pre></figure>

<p><a href="/assets/02-28-cont-graph-3-c1c385e808ce22f4e0b0dc78abb56fa3cea87af48485f0c9e509ff127e3e4950.png">
  <img src="/assets/02-28-cont-graph-3-c1c385e808ce22f4e0b0dc78abb56fa3cea87af48485f0c9e509ff127e3e4950.png" alt="Graph Continuous Variable Resids" class="zooming" data-rjs="/assets/02-28-cont-graph-3-c1c385e808ce22f4e0b0dc78abb56fa3cea87af48485f0c9e509ff127e3e4950.png" data-zooming-width="" data-zooming-height="" />
</a></p>

<h2 id="transformations">Transformations</h2>

<p>Transformations can be perfromed inside of the model formula, but if it contains an operation of <code class="highlighter-rouge">+, -, *, ^,</code> wrap it in <code class="highlighter-rouge">I()</code> so it doesn’t become part of the model specs. Let’s go through an example workflow again, this time with a polynomial transformation.</p>

<h5 id="1-create-and-graph-the-initial-data">1. <strong>Create and graph the initial data.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">sim2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tibble</span><span class="p">(</span><span class="w">
  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">3.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">pi</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="p">),</span><span class="w">
  </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">sim2</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span></code></pre></figure>

<p><a href="/assets/02-28-trans-graph-9f21e1f20c5d7a55c1dd44b49866c4c0f743e98ba0cf95469866111008e5a90f.png">
  <img src="/assets/02-28-trans-graph-9f21e1f20c5d7a55c1dd44b49866c4c0f743e98ba0cf95469866111008e5a90f.png" alt="Graph Data" class="zooming" data-rjs="/assets/02-28-trans-graph-9f21e1f20c5d7a55c1dd44b49866c4c0f743e98ba0cf95469866111008e5a90f.png" data-zooming-width="" data-zooming-height="" />
</a></p>

<h5 start="2" id="2-fit-linear-regressions-with-polynomials-up-to-degree-five-to-the-data">2. <strong>Fit linear regressions with polynomials up to degree five to the data.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">mod1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">ns</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim2</span><span class="p">)</span><span class="w">
</span><span class="n">mod2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">ns</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim2</span><span class="p">)</span><span class="w">
</span><span class="n">mod3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">ns</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim2</span><span class="p">)</span><span class="w">
</span><span class="n">mod4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">ns</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim2</span><span class="p">)</span><span class="w">
</span><span class="n">mod5</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">ns</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim2</span><span class="p">)</span></code></pre></figure>

<h5 start="3" id="3-put-predictions-into-a-data-frame">3. <strong>Put predictions into a data frame.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sim5</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">data_grid</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq_range</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">expand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">gather_predictions</span><span class="p">(</span><span class="n">mod1</span><span class="p">,</span><span class="w"> </span><span class="n">mod2</span><span class="p">,</span><span class="w"> </span><span class="n">mod3</span><span class="p">,</span><span class="w"> </span><span class="n">mod4</span><span class="p">,</span><span class="w"> </span><span class="n">mod5</span><span class="p">,</span><span class="w"> </span><span class="n">.pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"y"</span><span class="p">)</span></code></pre></figure>

<p><strong>Note:</strong> <code class="highlighter-rouge">seq_range()</code> provides a specified number of values between the minimum and maximum of a variable, which can be useful for graphing.</p>

<h5 start="4" id="4-graph-the-initial-data-with-the-fitted-models">4. <strong>Graph the initial data with the fitted models.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ggplot</span><span class="p">(</span><span class="n">sim2</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span></code></pre></figure>

<p><a href="/assets/02-28-trans-graph-2-496e70194cfde5967a73c03cfecc1efc6f32878367c20ed7b973892a146c3d82.png">
  <img src="/assets/02-28-trans-graph-2-496e70194cfde5967a73c03cfecc1efc6f32878367c20ed7b973892a146c3d82.png" alt="Graph Data with Predictions" class="zooming" data-rjs="/assets/02-28-trans-graph-2-496e70194cfde5967a73c03cfecc1efc6f32878367c20ed7b973892a146c3d82.png" data-zooming-width="" data-zooming-height="" />
</a></p>

<h5 start="5" id="5-add-the-residuals-to-the-initial-data-1">5. <strong>Add the residuals to the initial data.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">sim5</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sim5</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">gather_residuals</span><span class="p">(</span><span class="n">mod1</span><span class="p">,</span><span class="w"> </span><span class="n">mod2</span><span class="p">,</span><span class="w"> </span><span class="n">mod3</span><span class="p">,</span><span class="w"> </span><span class="n">mod4</span><span class="p">,</span><span class="w"> </span><span class="n">mod5</span><span class="p">)</span></code></pre></figure>

<h5 start="6" id="6-graph-the-initial-x-values-against-their-residuals-1">6. <strong>Graph the initial x-values against their residuals.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ggplot</span><span class="p">(</span><span class="n">sim5</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">resid</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"white"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span></code></pre></figure>

<p><a href="/assets/02-28-trans-graph-3-0751d9ca8c8e16fd828d4e7b9fff41ae67be720bf0ebc6401ec50874298b43ec.png">
  <img src="/assets/02-28-trans-graph-3-0751d9ca8c8e16fd828d4e7b9fff41ae67be720bf0ebc6401ec50874298b43ec.png" alt="Graph Data Residuals" class="zooming" data-rjs="/assets/02-28-trans-graph-3-0751d9ca8c8e16fd828d4e7b9fff41ae67be720bf0ebc6401ec50874298b43ec.png" data-zooming-width="" data-zooming-height="" />
</a></p>

<h2 id="many-models">Many Models</h2>

<p>If you have a complex dataset, it may be possible to unpack the data using many simple models. For example, the <em>gapminder</em> dataset contains data on the life expectancy, among other variables, in many countries over the course of 50 years. With this data, let’s explore how life expectancy changes over time for each country, and dig into which countries deviate significantly from the rest of the world.</p>

<h5 id="1-graph-the-initial-data-1">1. <strong>Graph the initial data.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="m">3</span><span class="p">)</span></code></pre></figure>

<p><a href="/assets/02-28-many-graph-2a17155b85c0ce7d3e9eceb6dd64e60d0c4c1d90760ed98bd0d27f1b918b3b80.png">
  <img src="/assets/02-28-many-graph-2a17155b85c0ce7d3e9eceb6dd64e60d0c4c1d90760ed98bd0d27f1b918b3b80.png" alt="Graph Data Many Models" class="zooming" data-rjs="/assets/02-28-many-graph-2a17155b85c0ce7d3e9eceb6dd64e60d0c4c1d90760ed98bd0d27f1b918b3b80.png" data-zooming-width="" data-zooming-height="" />
</a></p>

<h5 start="2" id="2-nest-the-data-frame-to-create-one-row-for-each-country-and-continent-with-a-new-column-of-data-frames-containing-the-rest-of-the-country-information">2. <strong>Nest the data frame to create one row for each country and continent, with a new column of data frames containing the rest of the country information.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">by_country</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">continent</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">nest</span><span class="p">()</span></code></pre></figure>

<h5 start="3" id="3-create-a-linear-model-and-run-it-over-each-country-storing-the-results-in-a-new-column">3. <strong>Create a linear model and run it over each country, storing the results in a new column.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># create a linear model function </span><span class="w">
</span><span class="n">country_model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">lm</span><span class="p">(</span><span class="n">lifeExp</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># run models and store them in a new list-column; helpful for filtering and arranging</span><span class="w">
</span><span class="n">by_country</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">by_country</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">country_model</span><span class="p">))</span></code></pre></figure>

<h5 start="4" id="4-add-residuals-to-the-data">4. <strong>Add residuals to the data.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">by_country</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">by_country</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">resids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map2</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">add_residuals</span><span class="p">))</span></code></pre></figure>

<h5 start="5" id="5-unnest-and-plot-the-residuals-by-continent-notice-that-the-model-performs-the-worst-in-africa">5. <strong>Unnest and plot the residuals by continent. Notice that the model performs the worst in Africa.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">resids</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unnest</span><span class="p">(</span><span class="n">by_country</span><span class="p">,</span><span class="w"> </span><span class="n">resids</span><span class="p">)</span><span class="w">
</span><span class="n">resids</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">resid</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span></code></pre></figure>

<p><a href="/assets/02-28-many-resids-2637202ed3863623aa9e86d22a5b8612e3dbe5a968f279a584b8495ab65c17cc.png">
  <img src="/assets/02-28-many-resids-2637202ed3863623aa9e86d22a5b8612e3dbe5a968f279a584b8495ab65c17cc.png" alt="Graph Data Many Residuals" class="zooming" data-rjs="/assets/02-28-many-resids-2637202ed3863623aa9e86d22a5b8612e3dbe5a968f279a584b8495ab65c17cc.png" data-zooming-width="" data-zooming-height="" />
</a></p>

<h5 start="7" id="7-unpack-the-data-by-using-glance-and-unnest-to-skim-and-add-model-data-to-the-data-frame">7. <strong>Unpack the data by using glance and unnest to skim and add model data to the data frame.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">glance</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">by_country</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">glance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">glance</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">unnest</span><span class="p">(</span><span class="n">glance</span><span class="p">,</span><span class="w"> </span><span class="n">.drop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<h5 start="6" id="8-graph-the-r-squared-coefficient-to-investigate-where-the-model-breaks-down">8. <strong>Graph the R-Squared coefficient to investigate where the model breaks down.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">glance</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">r.squared</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">continent</span><span class="p">,</span><span class="w"> </span><span class="n">r.squared</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_jitter</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span></code></pre></figure>

<p><a href="/assets/02-28-many-rsq-bb09d6d0dd29f3455053b0b256abe4e4c9414d6d2b1b9a5be6661dd518930d08.png">
  <img src="/assets/02-28-many-rsq-bb09d6d0dd29f3455053b0b256abe4e4c9414d6d2b1b9a5be6661dd518930d08.png" alt="Graph Data Many R-Squared" class="zooming" data-rjs="/assets/02-28-many-rsq-bb09d6d0dd29f3455053b0b256abe4e4c9414d6d2b1b9a5be6661dd518930d08.png" data-zooming-width="" data-zooming-height="" />
</a></p>

<h5 start="6" id="9-pull-out-the-problem-countries-into-a-separate-table-then-plot-the-life-expectancies-of-those-countries-over-time-by-joining-the-table-with-the-original-data">9. <strong>Pull out the problem countries into a separate table. Then, plot the life expectancies of those countries over time by joining the table with the original data.</strong></h5>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">bad_fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">glance</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">r.squared</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">.25</span><span class="p">)</span><span class="w">
</span><span class="n">gapminder</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">semi_join</span><span class="p">(</span><span class="n">bad_fit</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"country"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">lifeExp</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">country</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_line</span><span class="p">()</span></code></pre></figure>

<p><strong>Note:</strong> History provides an explanation where the data breaks down: this graph reveals the devastating effects of the Rwandan genocide and HIV/AIDS in African countries in the 1990s.</p>

<p><a href="/assets/02-28-many-drilldown-2dbd2f3e2c8c689e8274941cb0617159feceb474cb6ced1aadbabbe6cd5ce158.png">
  <img src="/assets/02-28-many-drilldown-2dbd2f3e2c8c689e8274941cb0617159feceb474cb6ced1aadbabbe6cd5ce158.png" alt="Graph Data Many Drilldown" class="zooming" data-rjs="/assets/02-28-many-drilldown-2dbd2f3e2c8c689e8274941cb0617159feceb474cb6ced1aadbabbe6cd5ce158.png" data-zooming-width="" data-zooming-height="" />
</a></p>

<h2 id="data-structures-list-columns">Data Structures: List-Columns</h2>

<p>The life expectancy example above made use of list-column data structures. In general, an effective list-column pipeline will take the following form:</p>
<ol>
  <li>Create the list-column.</li>
  <li>Create other intermediate list-columns by transforming existing list columns.</li>
  <li>Simplify the list-column back down to a data frame or atomic vector.</li>
</ol>

<h3 id="creating-list-columns">Creating List-Columns</h3>

<ul>
  <li><code class="highlighter-rouge">nest()</code> converts a grouped data frame into a nested data frame with a list-column of data frames.</li>
  <li><code class="highlighter-rouge">mutate()</code> applied with vectorized functions that return a list will create list-columns.</li>
  <li><code class="highlighter-rouge">summarize()</code> applied with summary functions that return multiple results will create list-columns.</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># summarize the quantiles of miles per gallon by the number of cylinders in the car</span><span class="w">
</span><span class="n">probs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.01</span><span class="p">,</span><span class="w"> </span><span class="m">0.25</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.75</span><span class="p">,</span><span class="w"> </span><span class="m">0.99</span><span class="p">)</span><span class="w">
</span><span class="n">mtcars</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">cyl</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">probs</span><span class="p">),</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">quantile</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">probs</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">unnest</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt;  A tibble: 15 x 3</span><span class="w">
</span><span class="c1">#&gt;     cyl     p     q</span><span class="w">
</span><span class="c1">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span><span class="w">
</span><span class="c1">#&gt; 1     4  0.01  21.4</span><span class="w">
</span><span class="c1">#&gt; 2     4  0.25  22.8</span><span class="w">
</span><span class="c1">#&gt; 3     4  0.5   26  </span><span class="w">
</span><span class="c1">#&gt; 4     4  0.75  30.4</span><span class="w">
</span><span class="c1">#&gt; 5     4  0.99  33.8</span><span class="w">
</span><span class="c1">#&gt; 6     6  0.01  17.8</span><span class="w">
</span><span class="c1">#&gt; 7     6  0.25  18.6</span><span class="w">
</span><span class="c1">#&gt; ...</span></code></pre></figure>

<h3 id="simplifying-list-columns">Simplifying List-Columns</h3>
<p>In order to manipulate and visualize the data, you will need to simplify list-columns.</p>

<ul>
  <li>If you want a single value from the list-column, use <code class="highlighter-rouge">mutate()</code> with <code class="highlighter-rouge">map_lgl(), map_int(), map_dbl(), map_chr()</code> to create an atomic vector.</li>
  <li>If you want many values from the list-column, use <code class="highlighter-rouge">unnest()</code> to convert list columns back to regular columns, repeating the rows as many times as necessary.</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># extract a single value by referring to its element name</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tribble</span><span class="p">(</span><span class="w">
  </span><span class="o">~</span><span class="n">x</span><span class="p">,</span><span class="w">
  </span><span class="nf">list</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w">
  </span><span class="nf">list</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">))</span><span class="w">

</span><span class="n">df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="w">
  </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map_dbl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s2">"a"</span><span class="p">),</span><span class="w">
  </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map_dbl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s2">"b"</span><span class="p">,</span><span class="w"> </span><span class="n">.null</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA_real_</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; A tibble: 2 x 3</span><span class="w">
</span><span class="c1">#&gt;   x                    a     b</span><span class="w">
</span><span class="c1">#&gt;   &lt;list&gt;           &lt;dbl&gt; &lt;dbl&gt;</span><span class="w">
</span><span class="c1">#&gt; 1 &lt;named list [2]&gt;     1     2</span><span class="w">
</span><span class="c1">#&gt; 2 &lt;named list [2]&gt;     2    NA</span><span class="w">
</span><span class="c1">#&gt; </span></code></pre></figure>

<h3 id="turning-models-into-tidy-data">Turning Models into Tidy Data</h3>
<p>The following three functions help turn models into tidy data, and often make use of list-columns.</p>

<ul>
  <li><code class="highlighter-rouge">glance()</code> returns a row for each model, where each column gives a model summary.</li>
  <li><code class="highlighter-rouge">tidy()</code> returns a row for each coefficient in the model, where each column has info about estimate/variability.</li>
  <li><code class="highlighter-rouge">augment()</code> returns a row for each row in data, adding extra values like residuals and influence stats.</li>
</ul>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>This post is meant for a person who is looking for a refresher on basic modeling in R. The content in this post is based on chapter twenty-two through twenty-five of <a href="https://r4ds.had.co.nz/index.html" target="blank">R for Data Science</a> by Hadley Wickham &amp; Garrett Grolemund. <a href="#fnref:1" class="reversefootnote">⤴</a></p>
    </li>
  </ol>
</div>

          </div>
          <!--
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=Model+Building+in+R%20-%20http://localhost:4000/posts/modeling-r" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/posts/modeling-r" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
          </div>
          -->
          <span class="backbutton"><a href="/posts/index">←Index</a></span>
          
        </article>
        <footer class="footer ">

<small class="pull-left"> &copy;2019 All rights reserved. 

<a href="https://github.com/nielsenramon/chalk" target="_blank">Chalk</a> theme by Nielson Ramon.

</small>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-160038909-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-160038909-1');
  </script>


<script src="/assets/vendor-2c224c53eb697c739f9490c38819a72184f09472739fd9e492272ef174090428.js" type="text/javascript"></script>


  <script src="/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js" type="text/javascript"></script>




<script src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js" type="text/javascript"></script>


  <script type="text/x-mathjax-config">
   MathJax.Hub.Config({
     extensions: [
       "MathMenu.js",
       "MathZoom.js",
       "AssistiveMML.js",
       "a11y/accessibility-menu.js"
     ],
     jax: ["input/TeX", "output/CommonHTML"],
     TeX: {
       extensions: [
         "AMSmath.js",
         "AMSsymbols.js",
         "noErrors.js",
         "noUndefined.js",
       ]
     }
   });
   MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
     var TEX = MathJax.InputJax.TeX;
     var COLS = function (W) {
       var WW = [];
       for (var i = 0, m = W.length; i < m; i++)
         {WW[i] = TEX.Parse.prototype.Em(W[i])}
       return WW.join(" ");
     };
     TEX.Definitions.Add({
       environment: {
         psmallmatrix: ['Array',null,'(',')','c',COLS([1/3]),".2em",'S',1],
       }
     });
   });
 </script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
